{% extends "base.html" %}

{% block title %}‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ - ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<style>
/* Action Buttons Styling */
.btn-group .btn {
    margin: 0 2px;
    transition: all 0.3s ease;
    border-radius: 8px;
}

.btn-group .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.btn-group .btn-outline-primary:hover {
    background-color: #0d6efd;
    border-color: #0d6efd;
    color: white;
}

.btn-group .btn-outline-warning:hover {
    background-color: #ffc107;
    border-color: #ffc107;
    color: #000;
}

.btn-group .btn-outline-danger:hover {
    background-color: #dc3545;
    border-color: #dc3545;
    color: white;
}

/* Delete Modal Styling */
.modal-header.bg-danger {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%) !important;
}

.alert-warning {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border: 1px solid #ffeaa7;
    color: #856404;
}

.alert-danger {
    background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
    border: 1px solid #f5c6cb;
    color: #721c24;
}

/* Responsive Button Group */
@media (max-width: 576px) {
    .btn-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    
    .btn-group .btn {
        margin: 0;
        width: 100%;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>
        <i class="fas fa-home me-2"></i>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
    </h2>
    <div class="d-flex gap-2">
        <a href="{{ url_for('user_repair_request') }}" class="btn btn-primary">
            <i class="fas fa-plus me-1"></i>‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà
        </a>
        <a href="{{ url_for('user_profile') }}" class="btn btn-outline-secondary">
            <i class="fas fa-user-edit me-1"></i>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
        </a>
    </div>
</div>

<!-- Welcome Card -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card welcome-card text-white dashboard-card fade-in-up">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-2 text-center">
                        {% if user.profile_image %}
                            <img src="{{ url_for('static', filename='uploads/' + user.profile_image) }}" 
                                 alt="Profile" class="rounded-circle profile-img" width="100" height="100">
                        {% else %}
                            <div class="bg-white rounded-circle d-flex align-items-center justify-content-center profile-img" 
                                 style="width: 100px; height: 100px;">
                                <i class="fas fa-user text-primary" style="font-size: 3rem;"></i>
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-md-8">
                        <h2 class="mb-2 dashboard-title">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, {{ user.full_name }}! üëã</h2>
                        <p class="mb-1 fs-5 dashboard-subtitle">
                            {% if user.room_number %}
                                üè† ‡∏´‡πâ‡∏≠‡∏á {{ user.room_number }} | 
                            {% endif %}
                            ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å
                        </p>
                        <small class="opacity-75">
                            <i class="fas fa-calendar me-1"></i>
                            <span id="current-date"></span>
                        </small>
                    </div>
                    <div class="col-md-2 text-end">
                        <i class="fas fa-home fa-5x opacity-50 pulse-animation"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card stat-card bg-gradient-warning text-white h-100 fade-in-up clickable-card" 
             style="animation-delay: 0.1s;" 
             onclick="filterRequests('pending')" 
             data-status="pending">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-1 fw-bold">{{ repair_requests|selectattr('status', 'equalto', 'pending')|list|length }}</h3>
                        <p class="mb-0 fs-6">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                        <small class="opacity-75">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</small>
                    </div>
                    <div class="text-end">
                        <i class="fas fa-clock stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card stat-card bg-gradient-info text-white h-100 fade-in-up clickable-card" 
             style="animation-delay: 0.2s;" 
             onclick="filterRequests('in_progress')" 
             data-status="in_progress">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-1 fw-bold">{{ repair_requests|selectattr('status', 'in', ['assigned', 'in_progress'])|list|length }}</h3>
                        <p class="mb-0 fs-6">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                        <small class="opacity-75">üîß ‡∏ä‡πà‡∏≤‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°</small>
                    </div>
                    <div class="text-end">
                        <i class="fas fa-tools stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card stat-card bg-gradient-success text-white h-100 fade-in-up clickable-card" 
             style="animation-delay: 0.3s;" 
             onclick="filterRequests('completed')" 
             data-status="completed">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-1 fw-bold">{{ repair_requests|selectattr('status', 'equalto', 'completed')|list|length }}</h3>
                        <p class="mb-0 fs-6">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</p>
                        <small class="opacity-75">‚úÖ ‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</small>
                    </div>
                    <div class="text-end">
                        <i class="fas fa-check-circle stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card stat-card bg-gradient-primary text-white h-100 fade-in-up clickable-card" 
             style="animation-delay: 0.4s;" 
             onclick="filterRequests('all')" 
             data-status="all">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-1 fw-bold">{{ repair_requests|length }}</h3>
                        <p class="mb-0 fs-6">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        <small class="opacity-75">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small>
                    </div>
                    <div class="text-end">
                        <i class="fas fa-list stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Repair Requests -->
<div class="row">
    <div class="col-12">
        <div class="card dashboard-card fade-in-up" style="animation-delay: 0.5s;">
            <div class="card-header d-flex justify-content-between align-items-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                </h5>
                <a href="{{ url_for('user_repair_request') }}" class="btn dashboard-btn btn-light">
                    <i class="fas fa-plus me-1"></i>‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà
                </a>
            </div>
            <div class="card-body">
                {% if repair_requests %}
                    <div class="table-responsive">
                        <table class="table dashboard-table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>‡∏´‡πâ‡∏≠‡∏á</th>
                                    <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                    <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</th>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th>‡∏ä‡πà‡∏≤‡∏á‡∏ã‡πà‡∏≠‡∏°</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á</th>
                                    <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for request in repair_requests %}
                                <tr>
                                    <td>
                                        <span class="badge bg-secondary">#{{ request.id }}</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ request.room_number }}</span>
                                    </td>
                                    <td>
                                        {% if request.repair_type == 'plumbing' %}
                                            <span class="badge bg-primary">
                                                <i class="fas fa-tint me-1"></i>‡∏õ‡∏£‡∏∞‡∏õ‡∏≤
                                            </span>
                                        {% elif request.repair_type == 'electrical' %}
                                            <span class="badge bg-warning">
                                                <i class="fas fa-bolt me-1"></i>‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
                                            </span>
                                        {% elif request.repair_type == 'furniture' %}
                                            <span class="badge bg-success">
                                                <i class="fas fa-couch me-1"></i>‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏ô‡∏¥‡πÄ‡∏à‡∏≠‡∏£‡πå
                                            </span>
                                        {% elif request.repair_type == 'air_conditioning' %}
                                            <span class="badge bg-info">
                                                <i class="fas fa-snowflake me-1"></i>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®
                                            </span>
                                        {% elif request.repair_type == 'internet' %}
                                            <span class="badge bg-secondary">
                                                <i class="fas fa-wifi me-1"></i>‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï
                                            </span>
                                        {% else %}
                                            <span class="badge bg-dark">
                                                <i class="fas fa-tools me-1"></i>‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if request.priority == 'urgent' %}
                                            <span class="badge bg-danger">‡∏î‡πà‡∏ß‡∏ô</span>
                                        {% elif request.priority == 'high' %}
                                            <span class="badge bg-warning">‡∏™‡∏π‡∏á</span>
                                        {% elif request.priority == 'medium' %}
                                            <span class="badge bg-info">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</span>
                                        {% else %}
                                            <span class="badge bg-secondary">‡∏ï‡πà‡∏≥</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if request.status == 'pending' %}
                                            <span class="status-badge status-pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                                        {% elif request.status == 'assigned' %}
                                            <span class="status-badge status-assigned">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</span>
                                        {% elif request.status == 'in_progress' %}
                                            <span class="status-badge status-in-progress">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                                        {% elif request.status == 'completed' %}
                                            <span class="status-badge status-completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>
                                        {% elif request.status == 'cancelled' %}
                                            <span class="status-badge bg-danger text-white">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if request.assigned_technician %}
                                            <div class="d-flex align-items-center">
                                                {% if request.assigned_technician.user.profile_image %}
                                                    <img src="{{ url_for('static', filename='uploads/' + request.assigned_technician.user.profile_image) }}" 
                                                         class="rounded-circle me-2" width="25" height="25">
                                                {% else %}
                                                    <div class="bg-secondary rounded-circle me-2 d-flex align-items-center justify-content-center" 
                                                         style="width: 25px; height: 25px;">
                                                        <i class="fas fa-wrench text-white" style="font-size: 10px;"></i>
                                                    </div>
                                                {% endif %}
                                                <div>
                                                    <div class="fw-bold">{{ request.assigned_technician.user.full_name }}</div>
                                                    <small class="text-muted">{{ request.assigned_technician.employee_id }}</small>
                                                </div>
                                            </div>
                                        {% else %}
                                            <span class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div>{{ request.created_at.strftime('%d/%m/%Y') }}</div>
                                        <small class="text-muted">{{ request.created_at.strftime('%H:%M') }}</small>
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-bs-toggle="modal" data-bs-target="#viewModal{{ request.id }}"
                                                    title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            {% if request.status == 'pending' %}
                                                <a href="{{ url_for('user_edit_repair', repair_id=request.id) }}" 
                                                   class="btn btn-sm btn-outline-warning" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                                        data-bs-toggle="modal" data-bs-target="#deleteModal{{ request.id }}"
                                                        title="‡∏•‡∏ö">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h5>
                        <p class="text-muted">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                        <a href="{{ url_for('user_repair_request') }}" class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- View Modal for each request -->
{% for request in repair_requests %}
<div class="modal fade" id="viewModal{{ request.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° #{{ request.id }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</h6>
                        <p><strong>‡∏´‡πâ‡∏≠‡∏á:</strong> {{ request.room_number }}</p>
                        <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> {{ request.repair_type }}</p>
                        <p><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</strong> {{ request.priority }}</p>
                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> 
                            {% if request.status == 'pending' %}
                                <span class="badge bg-warning">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                            {% elif request.status == 'assigned' %}
                                <span class="badge bg-info">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</span>
                            {% elif request.status == 'in_progress' %}
                                <span class="badge bg-primary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                            {% elif request.status == 'completed' %}
                                <span class="badge bg-success">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>
                            {% elif request.status == 'cancelled' %}
                                <span class="badge bg-danger">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
                            {% endif %}
                        </p>
                        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á:</strong> {{ request.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
                    </div>
                    <div class="col-md-6">
                        {% if request.assigned_technician %}
                            <h6>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≤‡∏á‡∏ã‡πà‡∏≠‡∏°</h6>
                            <div class="d-flex align-items-center mb-3">
                                {% if request.assigned_technician.user.profile_image %}
                                    <img src="{{ url_for('static', filename='uploads/' + request.assigned_technician.user.profile_image) }}" 
                                         class="rounded-circle me-3" width="50" height="50">
                                {% else %}
                                    <div class="bg-secondary rounded-circle me-3 d-flex align-items-center justify-content-center" 
                                         style="width: 50px; height: 50px;">
                                        <i class="fas fa-wrench text-white"></i>
                                    </div>
                                {% endif %}
                                <div>
                                    <div class="fw-bold">{{ request.assigned_technician.user.full_name }}</div>
                                    <small class="text-muted">{{ request.assigned_technician.employee_id }}</small>
                                    {% if request.assigned_technician.specialization %}
                                        <br><small class="text-muted">{{ request.assigned_technician.specialization }}</small>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if request.completed_at %}
                            <h6>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</h6>
                            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à:</strong> {{ request.completed_at.strftime('%d/%m/%Y %H:%M') }}</p>
                        {% endif %}
                    </div>
                </div>
                <hr>
                <h6>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h6>
                <p>{{ request.description }}</p>
                
                {% if request.image_path %}
                    <h6>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h6>
                    <img src="{{ url_for('static', filename='uploads/' + request.image_path) }}" 
                         class="img-fluid rounded" style="max-height: 300px;">
                {% endif %}
                
                {% if request.completion_image %}
                    <hr>
                    <h6>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°</h6>
                    <img src="{{ url_for('static', filename='uploads/' + request.completion_image) }}" 
                         class="img-fluid rounded" style="max-height: 300px;">
                {% endif %}
                
                {% if request.admin_notes %}
                    <hr>
                    <h6>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h6>
                    <p>{{ request.admin_notes }}</p>
                {% endif %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Delete Confirmation Modals -->
{% for request in repair_requests %}
{% if request.status == 'pending' %}
<div class="modal fade" id="deleteModal{{ request.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle me-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <i class="fas fa-trash fa-3x text-danger mb-3"></i>
                    <h5>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ô‡∏µ‡πâ?</h5>
                </div>
                
                <div class="alert alert-warning">
                    <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°:</strong><br>
                    <strong>ID:</strong> #{{ request.id }}<br>
                    <strong>‡∏´‡πâ‡∏≠‡∏á:</strong> {{ request.room_number }}<br>
                    <strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> 
                    {% if request.repair_type == 'plumbing' %}‡∏õ‡∏£‡∏∞‡∏õ‡∏≤
                    {% elif request.repair_type == 'electrical' %}‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
                    {% elif request.repair_type == 'furniture' %}‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏ô‡∏¥‡πÄ‡∏à‡∏≠‡∏£‡πå
                    {% elif request.repair_type == 'air_conditioning' %}‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®
                    {% elif request.repair_type == 'internet' %}‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï
                    {% else %}‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                    {% endif %}<br>
                    <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á:</strong> {{ request.created_at.strftime('%d/%m/%Y %H:%M') }}
                </div>
                
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <strong>‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</strong> ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
                <form method="POST" action="{{ url_for('user_delete_repair', repair_id=request.id) }}" 
                      style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endfor %}
{% endblock %}

{% block extra_js %}
<script>
// ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const options = { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        weekday: 'long'
    };
    const thaiDate = now.toLocaleDateString('th-TH', options);
    document.getElementById('current-date').textContent = thaiDate;
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
function filterRequests(status) {
    // ‡∏•‡∏ö selected class ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏õ‡∏∏‡πà‡∏°
    document.querySelectorAll('.clickable-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° selected class ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å
    event.currentTarget.classList.add('selected');
    
    // ‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    const tableRows = document.querySelectorAll('.dashboard-table tbody tr');
    let visibleCount = 0;
    
    tableRows.forEach(row => {
        const statusCell = row.querySelector('td:nth-child(5)'); // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        const statusText = statusCell.textContent.trim();
        
        let shouldShow = false;
        
        if (status === 'all') {
            shouldShow = true;
        } else if (status === 'pending') {
            shouldShow = statusText.includes('‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
        } else if (status === 'in_progress') {
            shouldShow = statusText.includes('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') || statusText.includes('‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        } else if (status === 'completed') {
            shouldShow = statusText.includes('‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô');
        }
        
        if (shouldShow) {
            row.style.display = '';
            visibleCount++;
        } else {
            row.style.display = 'none';
        }
    });
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const tableBody = document.querySelector('.dashboard-table tbody');
    let noDataMessage = tableBody.querySelector('.no-data-message');
    
    if (visibleCount === 0) {
        if (!noDataMessage) {
            noDataMessage = document.createElement('tr');
            noDataMessage.className = 'no-data-message';
            noDataMessage.innerHTML = `
                <td colspan="8" class="text-center py-4">
                    <i class="fas fa-search fa-2x text-muted mb-2"></i>
                    <h6 class="text-muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</h6>
                    <small class="text-muted">‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà</small>
                </td>
            `;
            tableBody.appendChild(noDataMessage);
        }
        noDataMessage.style.display = '';
    } else {
        if (noDataMessage) {
            noDataMessage.style.display = 'none';
        }
    }
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
    showFilterResult(status, visibleCount);
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
function showFilterResult(status, count) {
    const statusNames = {
        'all': '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        'pending': '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
        'in_progress': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
        'completed': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'
    };
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    let resultMessage = document.querySelector('.filter-result-message');
    if (!resultMessage) {
        resultMessage = document.createElement('div');
        resultMessage.className = 'filter-result-message alert alert-info mb-3';
        resultMessage.style.borderRadius = '10px';
        resultMessage.style.border = 'none';
        resultMessage.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        resultMessage.style.color = 'white';
        
        const tableContainer = document.querySelector('.table-responsive');
        tableContainer.parentNode.insertBefore(resultMessage, tableContainer);
    }
    
    resultMessage.innerHTML = `
        <i class="fas fa-filter me-2"></i>
        ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: <strong>${statusNames[status]}</strong> 
        (${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
        <button type="button" class="btn btn-sm btn-outline-light ms-2" onclick="clearFilter()">
            <i class="fas fa-times me-1"></i>‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
        </button>
    `;
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ animation
    resultMessage.style.opacity = '0';
    resultMessage.style.transform = 'translateY(-10px)';
    setTimeout(() => {
        resultMessage.style.transition = 'all 0.3s ease';
        resultMessage.style.opacity = '1';
        resultMessage.style.transform = 'translateY(0)';
    }, 100);
}

// ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
function clearFilter() {
    // ‡∏•‡∏ö selected class ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏õ‡∏∏‡πà‡∏°
    document.querySelectorAll('.clickable-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    const tableRows = document.querySelectorAll('.dashboard-table tbody tr');
    tableRows.forEach(row => {
        row.style.display = '';
    });
    
    // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    const resultMessage = document.querySelector('.filter-result-message');
    if (resultMessage) {
        resultMessage.style.transition = 'all 0.3s ease';
        resultMessage.style.opacity = '0';
        resultMessage.style.transform = 'translateY(-10px)';
        setTimeout(() => {
            resultMessage.remove();
        }, 300);
    }
    
    // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const noDataMessage = document.querySelector('.no-data-message');
    if (noDataMessage) {
        noDataMessage.style.display = 'none';
    }
}
</script>
{% endblock %}
