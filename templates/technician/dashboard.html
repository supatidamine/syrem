{% extends "base.html" %}

{% block title %}‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ä‡πà‡∏≤‡∏á‡∏ã‡πà‡∏≠‡∏° - ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<!-- Welcome Card -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card welcome-card text-white dashboard-card fade-in-up">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-2 text-center">
                        {% if user.profile_image %}
                            <img src="{{ url_for('static', filename='uploads/' + user.profile_image) }}" 
                                 alt="Profile" class="rounded-circle profile-img" width="100" height="100">
                        {% else %}
                            <div class="bg-white rounded-circle d-flex align-items-center justify-content-center profile-img" 
                                 style="width: 100px; height: 100px;">
                                <i class="fas fa-wrench text-success" style="font-size: 3rem;"></i>
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-md-8">
                        <h2 class="mb-2 dashboard-title">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, {{ user.full_name }}! üîß</h2>
                        <p class="mb-1 fs-5">
                            üÜî ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: {{ technician.employee_id }} | 
                            üõ†Ô∏è {{ technician.specialization or '‡∏ä‡πà‡∏≤‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' }}
                        </p>
                        <small class="opacity-75">
                            <i class="fas fa-calendar me-1"></i>
                            <span id="current-date"></span>
                        </small>
                    </div>
                    <div class="col-md-2 text-end">
                        <i class="fas fa-tools fa-5x opacity-50 pulse-animation"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card stat-card bg-gradient-primary text-white h-100 fade-in-up clickable-card" 
             style="animation-delay: 0.1s;" 
             onclick="filterRepairs('all')" 
             data-status="all">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-1 fw-bold">{{ assigned_repairs|selectattr('status', 'in', ['assigned', 'in_progress'])|list|length }}</h3>
                        <p class="mb-0 fs-6">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</p>
                        <small class="opacity-75">üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small>
                    </div>
                    <div class="text-end">
                        <i class="fas fa-tasks stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card stat-card bg-gradient-warning text-white h-100 fade-in-up clickable-card" 
             style="animation-delay: 0.2s;" 
             onclick="filterRepairs('assigned')" 
             data-status="assigned">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-1 fw-bold">{{ assigned_repairs|selectattr('status', 'equalto', 'assigned')|list|length }}</h3>
                        <p class="mb-0 fs-6">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                        <small class="opacity-75">‚è≥ ‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</small>
                    </div>
                    <div class="text-end">
                        <i class="fas fa-clock stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card stat-card bg-gradient-info text-white h-100 fade-in-up clickable-card" 
             style="animation-delay: 0.3s;" 
             onclick="filterRepairs('in_progress')" 
             data-status="in_progress">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-1 fw-bold">{{ assigned_repairs|selectattr('status', 'equalto', 'in_progress')|list|length }}</h3>
                        <p class="mb-0 fs-6">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                        <small class="opacity-75">üî® ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°</small>
                    </div>
                    <div class="text-end">
                        <i class="fas fa-hammer stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card stat-card bg-gradient-success text-white h-100 fade-in-up clickable-card" 
             style="animation-delay: 0.4s;" 
             onclick="filterRepairs('completed')" 
             data-status="completed">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="mb-1 fw-bold">{{ assigned_repairs|selectattr('status', 'equalto', 'completed')|list|length }}</h3>
                        <p class="mb-0 fs-6">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</p>
                        <small class="opacity-75">‚úÖ ‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</small>
                    </div>
                    <div class="text-end">
                        <i class="fas fa-check-circle stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Assigned Repairs -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢
                </h5>
                <div class="d-flex gap-2">
                    <a href="{{ url_for('technician_profile') }}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-user-edit me-1"></i>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if assigned_repairs %}
                    <div class="table-responsive">
                        <table class="table dashboard-table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</th>
                                    <th>‡∏´‡πâ‡∏≠‡∏á</th>
                                    <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                    <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</th>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á</th>
                                    <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for repair in assigned_repairs %}
                                <tr>
                                    <td>
                                        <span class="badge bg-secondary">#{{ repair.id }}</span>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            {% if repair.requester.profile_image %}
                                                <img src="{{ url_for('static', filename='uploads/' + repair.requester.profile_image) }}" 
                                                     class="rounded-circle me-2" width="35" height="35">
                                            {% else %}
                                                <div class="bg-secondary rounded-circle me-2 d-flex align-items-center justify-content-center" 
                                                     style="width: 35px; height: 35px;">
                                                    <i class="fas fa-user text-white"></i>
                                                </div>
                                            {% endif %}
                                            <div>
                                                <div class="fw-bold">{{ repair.requester.full_name }}</div>
                                                <small class="text-muted">{{ repair.requester.email }}</small>
                                                {% if repair.requester.phone %}
                                                    <br><small class="text-muted">
                                                        <i class="fas fa-phone me-1"></i>{{ repair.requester.phone }}
                                                    </small>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ repair.room_number }}</span>
                                    </td>
                                    <td>
                                        {% if repair.repair_type == 'plumbing' %}
                                            <span class="badge bg-primary">
                                                <i class="fas fa-tint me-1"></i>‡∏õ‡∏£‡∏∞‡∏õ‡∏≤
                                            </span>
                                        {% elif repair.repair_type == 'electrical' %}
                                            <span class="badge bg-warning">
                                                <i class="fas fa-bolt me-1"></i>‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
                                            </span>
                                        {% elif repair.repair_type == 'furniture' %}
                                            <span class="badge bg-success">
                                                <i class="fas fa-couch me-1"></i>‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏ô‡∏¥‡πÄ‡∏à‡∏≠‡∏£‡πå
                                            </span>
                                        {% elif repair.repair_type == 'air_conditioning' %}
                                            <span class="badge bg-info">
                                                <i class="fas fa-snowflake me-1"></i>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®
                                            </span>
                                        {% elif repair.repair_type == 'internet' %}
                                            <span class="badge bg-secondary">
                                                <i class="fas fa-wifi me-1"></i>‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï
                                            </span>
                                        {% else %}
                                            <span class="badge bg-dark">
                                                <i class="fas fa-tools me-1"></i>‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if repair.priority == 'urgent' %}
                                            <span class="badge bg-danger">‡∏î‡πà‡∏ß‡∏ô</span>
                                        {% elif repair.priority == 'high' %}
                                            <span class="badge bg-warning">‡∏™‡∏π‡∏á</span>
                                        {% elif repair.priority == 'medium' %}
                                            <span class="badge bg-info">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</span>
                                        {% else %}
                                            <span class="badge bg-secondary">‡∏ï‡πà‡∏≥</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if repair.status == 'assigned' %}
                                            <span class="badge bg-info">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</span>
                                        {% elif repair.status == 'in_progress' %}
                                            <span class="badge bg-primary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                                        {% elif repair.status == 'completed' %}
                                            <span class="badge bg-success">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div>{{ repair.created_at.strftime('%d/%m/%Y') }}</div>
                                        <small class="text-muted">{{ repair.created_at.strftime('%H:%M') }}</small>
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-bs-toggle="modal" data-bs-target="#viewModal{{ repair.id }}">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            
                                            {% if repair.status in ['assigned', 'in_progress'] %}
                                                <button type="button" class="btn btn-sm btn-outline-warning" 
                                                        data-bs-toggle="modal" data-bs-target="#updateModal{{ repair.id }}">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢</h5>
                        <p class="text-muted">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- View Modal for each repair -->
{% for repair in assigned_repairs %}
<div class="modal fade" id="viewModal{{ repair.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° #{{ repair.id }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</h6>
                        <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> {{ repair.requester.full_name }}</p>
                        <p><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> {{ repair.requester.email }}</p>
                        {% if repair.requester.phone %}
                            <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> {{ repair.requester.phone }}</p>
                        {% endif %}
                        {% if repair.requester.line_id %}
                            <p><strong>‡πÑ‡∏•‡∏ô‡πå ID:</strong> {{ repair.requester.line_id }}</p>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <h6>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</h6>
                        <p><strong>‡∏´‡πâ‡∏≠‡∏á:</strong> {{ repair.room_number }}</p>
                        <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> {{ repair.repair_type }}</p>
                        <p><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</strong> {{ repair.priority }}</p>
                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> {{ repair.status }}</p>
                        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á:</strong> {{ repair.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
                    </div>
                </div>
                <hr>
                <h6>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h6>
                <p>{{ repair.description }}</p>
                
                {% if repair.image_path %}
                    <h6>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h6>
                    <img src="{{ url_for('static', filename='uploads/' + repair.image_path) }}" 
                         class="img-fluid rounded" style="max-height: 300px;">
                {% endif %}
                
                {% if repair.admin_notes %}
                    <hr>
                    <h6>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h6>
                    <p>{{ repair.admin_notes }}</p>
                {% endif %}
                
                {% if repair.completion_image %}
                    <hr>
                    <h6>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°</h6>
                    <img src="{{ url_for('static', filename='uploads/' + repair.completion_image) }}" 
                         class="img-fluid rounded" style="max-height: 300px;">
                {% endif %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>
</div>

<!-- Update Status Modal for each repair -->
{% if repair.status in ['assigned', 'in_progress'] %}
<div class="modal fade" id="updateModal{{ repair.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô #{{ repair.id }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('technician_update_status', repair_id=repair.id) }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="status" class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà</label>
                        <select class="form-select" id="status" name="status" required>
                            {% if repair.status == 'assigned' %}
                                <option value="in_progress">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                                <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                            {% elif repair.status == 'in_progress' %}
                                <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                            {% endif %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="completion_image" class="form-label">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="file" class="form-control" id="completion_image" name="completion_image" accept="image/*">
                    </div>
                    
                    <div class="mb-3">
                        <label for="notes" class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn btn-warning">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endfor %}
{% endblock %}

{% block extra_js %}
<script>
// ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const options = { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        weekday: 'long'
    };
    const thaiDate = now.toLocaleDateString('th-TH', options);
    document.getElementById('current-date').textContent = thaiDate;
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
function filterRepairs(status) {
    // ‡∏•‡∏ö selected class ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏õ‡∏∏‡πà‡∏°
    document.querySelectorAll('.clickable-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° selected class ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å
    event.currentTarget.classList.add('selected');
    
    // ‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    const tableRows = document.querySelectorAll('.dashboard-table tbody tr');
    let visibleCount = 0;
    
    tableRows.forEach(row => {
        const statusCell = row.querySelector('td:nth-child(6)'); // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        const statusText = statusCell.textContent.trim();
        
        let shouldShow = false;
        
        if (status === 'all') {
            shouldShow = true;
        } else if (status === 'assigned') {
            shouldShow = statusText.includes('‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        } else if (status === 'in_progress') {
            shouldShow = statusText.includes('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
        } else if (status === 'completed') {
            shouldShow = statusText.includes('‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô');
        }
        
        if (shouldShow) {
            row.style.display = '';
            visibleCount++;
        } else {
            row.style.display = 'none';
        }
    });
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const tableBody = document.querySelector('.dashboard-table tbody');
    let noDataMessage = tableBody.querySelector('.no-data-message');
    
    if (visibleCount === 0) {
        if (!noDataMessage) {
            noDataMessage = document.createElement('tr');
            noDataMessage.className = 'no-data-message';
            noDataMessage.innerHTML = `
                <td colspan="8" class="text-center py-4">
                    <i class="fas fa-search fa-2x text-muted mb-2"></i>
                    <h6 class="text-muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</h6>
                    <small class="text-muted">‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</small>
                </td>
            `;
            tableBody.appendChild(noDataMessage);
        }
        noDataMessage.style.display = '';
    } else {
        if (noDataMessage) {
            noDataMessage.style.display = 'none';
        }
    }
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
    showFilterResult(status, visibleCount);
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
function showFilterResult(status, count) {
    const statusNames = {
        'all': '‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        'assigned': '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
        'in_progress': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
        'completed': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'
    };
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    let resultMessage = document.querySelector('.filter-result-message');
    if (!resultMessage) {
        resultMessage = document.createElement('div');
        resultMessage.className = 'filter-result-message alert alert-info mb-3';
        resultMessage.style.borderRadius = '10px';
        resultMessage.style.border = 'none';
        resultMessage.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        resultMessage.style.color = 'white';
        
        const tableContainer = document.querySelector('.table-responsive');
        tableContainer.parentNode.insertBefore(resultMessage, tableContainer);
    }
    
    resultMessage.innerHTML = `
        <i class="fas fa-filter me-2"></i>
        ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: <strong>${statusNames[status]}</strong> 
        (${count} ‡∏á‡∏≤‡∏ô)
        <button type="button" class="btn btn-sm btn-outline-light ms-2" onclick="clearFilter()">
            <i class="fas fa-times me-1"></i>‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
        </button>
    `;
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ animation
    resultMessage.style.opacity = '0';
    resultMessage.style.transform = 'translateY(-10px)';
    setTimeout(() => {
        resultMessage.style.transition = 'all 0.3s ease';
        resultMessage.style.opacity = '1';
        resultMessage.style.transform = 'translateY(0)';
    }, 100);
}

// ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
function clearFilter() {
    // ‡∏•‡∏ö selected class ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏õ‡∏∏‡πà‡∏°
    document.querySelectorAll('.clickable-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    const tableRows = document.querySelectorAll('.dashboard-table tbody tr');
    tableRows.forEach(row => {
        row.style.display = '';
    });
    
    // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    const resultMessage = document.querySelector('.filter-result-message');
    if (resultMessage) {
        resultMessage.style.transition = 'all 0.3s ease';
        resultMessage.style.opacity = '0';
        resultMessage.style.transform = 'translateY(-10px)';
        setTimeout(() => {
            resultMessage.remove();
        }, 300);
    }
    
    // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const noDataMessage = document.querySelector('.no-data-message');
    if (noDataMessage) {
        noDataMessage.style.display = 'none';
    }
}
</script>
{% endblock %}
